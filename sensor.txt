#include "mbed.h"

//#define ADT7420_TEMP_REG (0x00)
//#define ADT7420_CONF_REG (0x03)
#define PCF_ADDR (0x20)
#define beep_on (0xDF)
#define beep_off (0x20)
#define clear (0xC0)


I2C i2c(I2C_SDA,I2C_SCL);
RawSerial pc(SERIAL_TX, SERIAL_RX, 115200);

int main()
{

    
    
    pc.printf("I2C Test program: Infrared length. sensor\r\n");
    i2c.frequency(100000);
    
    
    while(1)
    {
        char data_write[3];
        char data_read[1];
        //char data_read2[1];
        i2c.read(((PCF_ADDR<<1) | 0x01),data_read,1,0);
        int distance = (int)data_read[0];
        pc.printf("distance : %d  \r\n",distance);
        data_write[0] = distance & beep_on;
        data_write[1] = distance | beep_off;
        data_write[2] = distance | clear;
        //pc.printf("     :     %d\r\n",distance & beep_on);
        //i2c.write(PCF_ADDR<<1,&data_write[2],1);
        if((distance & 0xC0)<192)
        {
            pc.printf("detect !!\r\n");
            i2c.write(PCF_ADDR<<1,&data_write[0],1,0);

        }
        else
        {
            
            i2c.write(PCF_ADDR<<1,&data_write[1],1,0);
        }
        
        
        wait(0.1);
        i2c.write(PCF_ADDR<<1,&data_write[2],1,0);
    }
}